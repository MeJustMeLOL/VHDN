<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Presentation — Tree Navigation (Nested Branches)</title>

</head>
<body>
  <canvas id="particles"></canvas>

  <div class="deck" id="deck">
    <!-- (markup kept identical to original uploaded file, but script below updated to support nested branches) -->
  <!-- Slide 1: giữ nguyên (mở đầu) -->
  <section class="slide anim intro" data-notes="Slide 1: Giới thiệu">
      <div class="centered">
        <h1 class="fx" data-fx="pop" data-fx-dur="600">Văn Hóa Doanh Nghiệp</h1>
        <div class="footer"><span>Người thuyết trình :</span><span class="meta">Slide 1/1</span></div>
      </div>
  </section>

    <!-- Slide 2: Tree navigation (root) -->
    <section class="slide anim grid grid-2" id="slide-tree" data-notes="Cây nội dung — click vào node để đi tới slide branch">
      <div class="sector tree-col">
        <div class="tree-root"> Nội dung</div>

        <!-- Tree structure (ví dụ) -->
        <div id="tree">
          <div class="tree-node" data-branch="Nhân Viên.1" tabindex="0">
        1. Định Hướng và  phát triển nhân viên
        <div class="node-action">Click để mở branch</div>

        <div class="node-children">
          <div class="tree-node small" data-branch="Nhân Viên.1.1" tabindex="0">
            1.1 Định hướng nhân viên trong văn hoá doanh nghiệp
          </div>

          <div class="tree-node small" data-branch="Nhân Viên.1.2" tabindex="0">
            1.2 Đào tạo nhân viên trong xây dựng văn hoá doanh nghiệp
          </div>

          <!-- 1.3 là parent của 1.3.1 -> đặt node-children BÊN TRONG nó -->
          <div class="tree-node small" data-branch="Nhân Viên.1.3" tabindex="0">
            1.3 Vai trò và tác động của định hướng – đào tạo đối với văn hoá doanh nghiệp
          </div>

        </div>
      </div>


          <div class="tree-node" data-branch="ĐàoTạo.2" tabindex="0">
            2.Đào Tạo và phát triển  nhân lực
            <div class="node-action">Click để mở branch</div>
            <div class="node-children">
              <div class="tree-node small" data-branch="ĐàoTạo.2.1">2.1 Các Kế Hoạch Đào Tạo</div>
            </div>
          </div>

          <div class="tree-node" data-branch="GanKetTapThe" tabindex="0">
            3.Gắn kết tập thể
            <div class="node-action">Click để mở branch</div>
            <div class="node-children">
              <div class="tree-node small" data-branch="GanKetTapThe.1">Ý nghĩa</div>
              <div class="tree-node small" data-branch="GanKetTapThe.2">Hoạt động</div>
              <div class="tree-node small" data-branch="GanKetTapThe.3">Ví dụ & Kết luận</div>
            </div>
          </div>

          <!-- Replace the existing khen thưởng node in #tree with this block -->
          <div class="tree-node" data-branch="KhenThuong" tabindex="0">
            4. khen thưởng và công nhận
            <div class="node-action">Click để mở branch</div>

            <div class="node-children">
              <div class="tree-node small" data-branch="KhenThuong.3.1">Khái Niệm</div>
              <div class="tree-node small" data-branch="KhenThuong.3.2">Các nội dung khen thưởng
                <div class="node-children">
                  <div class="tree-node small" data-branch="KhenThuong.3.2.1" tabindex="0">4.2.1 Ghi nhận kịp thời và công khai</div>
                  <div class="tree-node small" data-branch="KhenThuong.3.2.2" tabindex="0">4.2.2 Khen thưởng đa dạng và ý nghĩa</div>
                </div>
              </div>

              <div class="tree-node small" data-branch="KhenThuong.3.3">Gắn kết & Triển khai
                <div class="node-children">
                  <div class="tree-node small" data-branch="KhenThuong.3.3.1" tabindex="0">4.3.1 Nguyên tắc liên kết</div>
                  <div class="tree-node small" data-branch="KhenThuong.3.3.2" tabindex="0">4.3.2 Ví dụ & thực thi</div>
                  <div class="tree-node small" data-branch="KhenThuong.3.3.3" tabindex="0">4.3.3 Gắn kết khen thưởng với giá trị cốt lõi</div>
                </div>
              </div>
            </div>
          </div>

          </div>
          <div class="tree-node" data-branch="TruyenThong" tabindex="0">
            5.Truyền Thông Va Nội Bộ
            <div class="node-action">Click để mở branch</div>
            <div class="node-children">
              <div class="tree-node small" data-branch="TruyenThong.1">Nội Dung 1</div>
              <div class="tree-node small" data-branch="TruyenThong.2">Nội Dung 2</div>
            </div>
          </div>
        </div>
      </div>

      <div class="sector tree-canvas">
        <!-- Placeholder hero area; when a branch clicked, JS will navigate to the branch slides -->
        <div id="treeCanvasInner" style="text-align:center">
          <img src="https://images.unsplash.com/photo-1506765515384-028b60a970df?q=80&w=1200&auto=format&fit=crop" alt="Tree hero" class="branch-hero fx" data-fx="pop" data-fx-dur="520">
          <p class="branch-content fx" data-fx="fadeUp" data-fx-dur="480" data-fx-delay="120" style="margin-top:18px">
            Diễn Giải Hình
          </p>
        </div>
        <div class="footer"><span></span><span class="meta">Cây nội dung</span></div>
      </div>
    </section>

    <!-- Nhân Viên 1.1 #############################################################################################################--------------------->
    <section class="slide anim split-vertical" data-branch="Nhân Viên.1.1" data-branch-index="0" data-notes="Định Nghĩa" data-noborder="true">
  <!-- LEFT: bullets (luôn hiển thị) -->
  <div class="half left">
    <h2 class="fx" data-fx="pop">Định Hướng Nhân Viên là gì ?</h2>
    <p class="fx" data-fx="pop">Định hướng nhân viên là bước khởi đầu giúp người lao động, đặc biệt là nhân viên mới, làm quen với môi trường làm việc, hiểu rõ sứ mệnh, tầm nhìn và giá trị cốt lõi của doanh nghiệp. Một chương trình định hướng hiệu quả không chỉ giới thiệu về lịch sử hình thành và phát triển của tổ chức, mà còn truyền đạt những chuẩn mực ứng xử, cách làm việc và tinh thần chung. Thông qua đó, nhân viên mới cảm thấy mình là một phần của tập thể, từ đó hình thành lòng trung thành và cam kết gắn bó lâu dài.</p>
  </div>

  <!-- RIGHT: staged but column reserved (initially hidden) -->
  <div class="half right staged-hidden" data-staged="true">
    <h3 class="fx" data-fx="pop" data-fx-delay="80">Chi tiết khen thưởng</h3>
    <p class="fx" data-fx="fadeUp" data-fx-delay="160">
      Các hoạt động định hướng phổ biến hiện nay bao gồm buổi onboarding giới thiệu tổng quan về công ty, xây dựng sổ tay nhân viên để cung cấp các quy định và giá trị cốt lõi, tổ chức các hoạt động team bonding để gắn kết tập thể, và áp dụng mô hình mentoring với sự hỗ trợ của những nhân viên giàu kinh nghiệm.
    </p>
  </div>
<!-- Nhân Viên #############################################################################################################--------------------->
  <div class="footer"><span></span><span class="meta">Khen thưởng</span></div>
</section>
<section class="slide anim split-vertical" data-branch="Nhân Viên.1.1" data-branch-index="1" data-notes="Nhân Viên - 2" data-noborder="true">
<div class="half left">
  <h2 class="fx" data-fx="faded">1 số ví dụ tiêu biểu</h2>
  <p class="fx" data-fx="faded">
    Tại Google, nhân viên mới được gọi là “Noogler” và phải tham gia chương trình
    “Noogler Orientation” để hiểu sâu về tinh thần sáng tạo, khuyến khích đổi mới và cách Google vận hành.
  <br></br>
   Ở Việt Nam, FPT có “Ngày hội Tân binh” – nơi nhân viên mới được giới thiệu về sáu giá trị cốt lõi
    Tôn – Đổi – Đồng – Chí – Gương – Sáng, giúp họ nhanh chóng hòa nhập với môi trường làm việc năng động.</p>
</div>
<div class="half right">
  <h2 class="fx" data-fx="pop">Noogler Orientation</h2>
  <img src="https://media.licdn.com/dms/image/C4E22AQFK-50Y5S544w/feedshare-shrink_800/0/1552516003408?e=2147483647&v=beta&t=3GYF5JKkcAVFB32svlJVmhbjO7LATkFSyed4qZzwQQA"
       alt="Noogler Orientation tại Google">

</div>
</section>
<section class="slide anim" data-branch="Nhân Viên.1.2" data-branch-index="2" data-notes="Nhân Viên - 3">
  <h2 class="fx" data-fx="faded">Một chương trình đào tạo toàn diện</h2>
  <p class="fx" data-fx="faded">
    Một chương trình đào tạo toàn diện cần tập trung vào ba khía cạnh:
    <strong>kiến thức chuyên môn</strong>,
    <strong>kỹ năng mềm</strong>
    và <strong>giá trị văn hoá</strong>.
  </p>

  <div class="grid-3">
    <div class="fx" data-fx="pop">
      <h3>Kiến thức chuyên môn</h3>
      <p>Giúp nhân viên đáp ứng yêu cầu công việc, nắm vững nghiệp vụ.</p>
    </div>
    <div class="fx" data-fx="pop">
      <h3>Kỹ năng mềm</h3>
      <p>Giao tiếp, làm việc nhóm, quản lý xung đột → hợp tác hiệu quả.</p>
    </div>
    <div class="fx" data-fx="pop">
      <h3>Giá trị văn hoá</h3>
      <p>Đảm bảo sự đồng bộ trong hành vi và tư duy toàn tổ chức.</p>
    </div>
  </div>

  <p class="fx" data-fx="faded">
    Đặc biệt, <strong>đào tạo cấp quản lý</strong> rất quan trọng vì lãnh đạo là người làm gương và lan tỏa văn hoá mạnh mẽ nhất.
  </p>
  <p class="fx" data-fx="faded">
    Các phương pháp hiện đại: workshop, case study, e-learning, coaching & mentoring.
  </p>
</section>
<section class="slide anim split-vertical" data-branch="Nhân Viên.1.2" data-branch-index="3" data-notes="Nhân Viên - 4" data-noborder="true">
  <div class="half left">
    <h2 class="fx" data-fx="faded">Ví dụ thực tế</h2>
    <ul class="fx" data-fx="faded">
      <li>Starbucks có chương trình đào tạo <strong>“Barista Basics Training Program”</strong>,
          nhấn mạnh triết lý “tạo ra trải nghiệm cho khách hàng”.</li>
      <li>Tại <strong>Viettel</strong>, doanh nghiệp đào tạo thường xuyên về tinh thần
          “nghĩ lớn, làm lớn” và kỷ luật quân đội → xây dựng văn hoá trách nhiệm và kỷ cương mạnh mẽ.</li>
    </ul>
  </div>
  <div class="half right">
    <img src="https://images.unsplash.com/photo-1517248135467-4c7edcad34c4"
         alt="Starbucks training"
         style="width:100%; height:auto; border-radius:12px;">
  </div>
</section>
<!-- Slide: Định hướng & Đào tạo - Morph grid 3 (top 50% divided, bottom 50% full) -->

<section class="slide anim" data-branch="Nhân Viên.1.3" data-notes="Kết luận: Định hướng & Đào tạo">
  <div style="display:flex;flex-direction:column;gap:18px;align-items:center;justify-content:center;height:100%;padding:28px;box-sizing:border-box">
    <h2 class="fx" data-fx="pop">Kết luận — Vai trò của định hướng & đào tạo</h2>

    <p class="fx" data-fx="fadeUp" data-fx-delay="80" style="max-width:76ch;text-align:center;color:var(--muted);line-height:1.6">
      Định hướng và đào tạo không chỉ là nhiệm vụ nhân sự mà còn là một chiến lược văn hoá:
      xây dựng sự gắn kết, nâng cao hiệu suất, giữ và phát triển nhân tài, đồng thời củng cố hình ảnh thương hiệu.
      Khi được triển khai bài bản — đặc biệt ở cấp lãnh đạo — chương trình đào tạo trở thành lợi thế cạnh tranh bền vững.
    </p>

    <ul class="fx" data-fx="fadeUp" data-fx-delay="160" style="max-width:56ch;color:var(--muted);">
      <li><strong>Tập trung vào 3 trụ cột:</strong> chuyên môn, kỹ năng mềm, giá trị văn hoá.</li>
      <li><strong>Đa dạng hoá phương pháp:</strong> workshop, case study, e-learning, coaching/mentoring.</li>
      <li><strong>Đo lường & liên tục:</strong> đánh giá hiệu quả, hoàn thiện chương trình theo feedback.</li>
    </ul>

    <div class="fx" data-fx="pop" data-fx-dur="420" style="margin-top:8px">
      <em style="color:var(--muted)">Hành động gợi ý: bắt đầu với một chương trình thử nghiệm (pilot) cho 1 team, đo lường tác động trong 3–6 tháng và nhân rộng.</em>
    </div>
  </div>

  <div class="footer"><span></span><span class="meta">Kết luận</span></div>
</section>

<!-- Đào Tạo: normalized branch IDs and unique children -->
<section class="slide anim split-vertical" data-branch="ĐàoTạo.2.1" data-branch-index="1" data-notes="Onboarding">
  <div class="half left">
    <h2 class="fx" data-fx="faded">1. Đào tạo nhân viên mới (Onboarding)</h2>
    <p class="fx" data-fx="faded">
      Giai đoạn đầu tiên và cực kỳ quan trọng, giúp nhân viên mới hòa nhập nhanh chóng với văn hóa công ty và công việc.
    </p>
    <p class="fx" data-fx="fadeUp">Ví dụ: Một công ty công nghệ tổ chức chương trình đào tạo kéo dài 2 tuần cho nhân viên mới.</p>
    <ul class="fx" data-fx="fadeUp">
      <li>Tuần 1: Giới thiệu lịch sử, sứ mệnh, giá trị cốt lõi.</li>
      <li>Tuần 2: Đào tạo công cụ, phần mềm nội bộ và quy trình.</li>
    </ul>
  </div>
  <div class="half right fx" data-fx="pop">
    <img src="https://images.unsplash.com/photo-1522071820081-009f0129c71c" alt="Onboarding Training" style="width:100%; border-radius:12px; object-fit:cover;">
  </div>
</section>

<section class="slide anim split-vertical" data-branch="ĐàoTạo.2.1" data-branch-index="2" data-notes="Chuyên môn">
  <div class="half left">
    <h2 class="fx" data-fx="faded">2. Đào tạo kỹ năng chuyên môn</h2>
    <p class="fx" data-fx="pop">Đây là loại hình đào tạo nhằm nâng cao các kỹ năng trực tiếp liên quan đến công việc của nhân viên.</p>
    <ul class="fx" data-fx="fadeUp">
      <li>Ngân hàng: khoá học phân tích tài chính chuyên sâu cho chuyên viên tín dụng.</li>
      <li>Nhà máy ô tô: huấn luyện kỹ thuật lắp ráp và bảo trì máy móc mới.</li>
    </ul>
  </div>
  <div class="half right fx" data-fx="pop">
    <img src="https://images.unsplash.com/photo-1556740749-887f6717d7e4" alt="Professional Training" style="width:100%; border-radius:12px; object-fit:cover;">
  </div>
</section>

<section class="slide anim split-vertical" data-branch="ĐàoTạo.2.1" data-branch-index="3" data-notes="Kỹ năng mềm">
  <div class="half left">
    <h2 class="fx" data-fx="faded">3. Đào tạo kỹ năng mềm</h2>
    <p class="fx" data-fx="faded">Đây là các kỹ năng không liên quan trực tiếp đến chuyên môn nhưng lại rất cần thiết để làm việc hiệu quả.</p>
    <ul class="fx" data-fx="fadeUp">
      <li>Dịch vụ khách hàng: khóa học về kỹ năng giao tiếp và xử lý tình huống khó.</li>
      <li>Truyền thông: hội thảo về lãnh đạo và quản lý đội nhóm cho các cấp quản lý.</li>
    </ul>
  </div>
  <div class="half right fx" data-fx="pop">
    <img src="https://images.unsplash.com/photo-1551836022-d5d88e9218df" alt="Soft Skills Training" style="width:100%; border-radius:12px; object-fit:cover;">
  </div>
</section>

<section class="slide anim split-vertical" data-branch="ĐàoTạo.2.1" data-branch-index="4" data-notes="Job Rotation">
  <div class="half left">
    <h2 class="fx" data-fx="faded">4. Luân chuyển công việc (Job Rotation)</h2>
    <p class="fx" data-fx="faded">
      Phương pháp phát triển nhân lực bằng cách cho phép nhân viên trải nghiệm nhiều vị trí công việc khác nhau.
    </p>
    <ul class="fx" data-fx="fadeUp">
      <li>Tập đoàn bán lẻ: nhân viên tiềm năng luân chuyển giữa kinh doanh, marketing và chuỗi cung ứng.</li>
      <li>Giúp nhân viên có cái nhìn tổng quan & định hướng nghề nghiệp rõ ràng hơn.</li>
    </ul>
  </div>
  <div class="half right fx" data-fx="pop">
    <img src="https://images.unsplash.com/photo-1519389950473-47ba0277781c" alt="Job Rotation" style="width:100%; border-radius:12px; object-fit:cover;">
  </div>
</section>

<section class="slide anim split-vertical" data-branch="ĐàoTạo.2.1" data-branch-index="5" data-notes="Mentorship">
  <div class="half left">
    <h2 class="fx" data-fx="faded">5. Phát triển thông qua cố vấn (Mentorship Program)</h2>
    <p class="fx" data-fx="faded">Nhân viên mới hoặc nhân viên trẻ được mentor giàu kinh nghiệm hướng dẫn và chia sẻ kiến thức.</p>
    <ul class="fx" data-fx="fadeUp">
      <li>Công ty tư vấn pháp luật: mỗi luật sư trẻ ghép cặp với một luật sư cấp cao.</li>
      <li>Mentor hỗ trợ, định hướng sự nghiệp và giải quyết khó khăn.</li>
    </ul>
  </div>
  <div class="half right fx" data-fx="pop">
    <img src="https://images.unsplash.com/photo-1521737604893-d14cc237f11d" alt="Mentorship Program" style="width:100%; border-radius:12px; object-fit:cover;">
  </div>
</section>

<section class="slide anim split-vertical" data-branch="ĐàoTạo.2.1" data-branch-index="6" data-notes="Self-learning">
  <div class="half left">
    <h2 class="fx" data-fx="faded">6. Tự đào tạo và học hỏi (Self-learning)</h2>
    <p class="fx" data-fx="faded">Doanh nghiệp khuyến khích và tạo điều kiện để nhân viên tự học hỏi, phát triển bản thân.</p>
    <ul class="fx" data-fx="fadeUp">
      <li>Cung cấp tài khoản học trực tuyến (Coursera, Udemy).</li>
      <li>Chính sách hỗ trợ tài chính cho khóa học & chứng chỉ chuyên ngành.</li>
    </ul>
  </div>
  <div class="half right fx" data-fx="pop">
    <img src="https://images.unsplash.com/photo-1555529669-e69e7aa0ba9a" alt="Self Learning" style="width:100%; border-radius:12px; object-fit:cover;">
  </div>
</section>
<!-- ===== CSS dành cho các slide Chương 3 (dán vào <style>) ===== -->
<style>
/* chung cho các section */
section[data-branch^="GanKetTapThe"] {
  padding: 36px 28px;
  max-width: 1024px;
  margin: 30px auto;
  border-radius: 14px;
  background: linear-gradient(180deg, rgba(255,255,255,0.96), rgba(250,250,253,0.98));
  box-shadow: 0 8px 30px rgba(12,20,40,0.06);
  color: #152238;
  animation: fadeInUp .6s ease both;
}

/* tiêu đề chính */
section[data-branch^="GanKetTapThe"] h2 {
  font-size: 1.9rem;
  margin: 0 0 14px 0;
  font-weight: 800;
  background: linear-gradient(90deg,#0066ff,#00c2b3);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  text-align: center;
}

/* layout: ảnh + nội dung (responsive) */
.gkt-row {
  display: flex;
  gap: 22px;
  align-items: flex-start;
  margin-top: 12px;
}
.gkt-col {
  flex: 1 1 0;
}

/* ảnh */
.gkt-img {
  max-width: 360px;
  width: 100%;
  border-radius: 12px;
  box-shadow: 0 8px 20px rgba(3,14,21,0.12);
  object-fit: cover;
  display: block;
}

/* danh sách đẹp */
section[data-branch^="GanKetTapThe"] ul {
  list-style: none;
  padding-left: 0;
  margin: 12px 0;
}
.gkt-list li {
  position: relative;
  padding-left: 34px;
  margin-bottom: 10px;
  line-height: 1.6;
  font-size: 1.03rem;
}
.gkt-list li::before {
  content: "✔";
  position: absolute;
  left: 0;
  top: 0;
  color: #00b894;
  font-weight: 700;
  transform: translateY(-1px);
}

/* tiêu đề phụ */
section[data-branch^="GanKetTapThe"] h3 {
  margin-top: 16px;
  margin-bottom: 8px;
  font-size: 1.12rem;
  color: #0057d9;
  padding-left: 8px;
  border-left: 4px solid rgba(0,194,179,0.15);
}

/* đoạn text có nền nhẹ */
.gkt-card {
  background: #ffffff;
  padding: 12px 14px;
  border-radius: 10px;
  box-shadow: 0 6px 18px rgba(12,20,40,0.03);
}

/* animation */
@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(12px); }
  to { opacity: 1; transform: translateY(0); }
}

/* responsive */
@media (max-width: 820px) {
  .gkt-row { flex-direction: column-reverse; }
  .gkt-img { max-width: 100%; }
}
</style>

<!-- ===== Chương 3: 3 slide tương ứng node bạn cung cấp ===== -->

<!-- Slide 1: Ý nghĩa -->
<section data-branch="GanKetTapThe.1">
  <h2>Gắn kết tập thể trong xây dựng văn hoá doanh nghiệp</h2>

  <div class="gkt-row">
    <div class="gkt-col gkt-card">
      <p>
        Gắn kết tập thể là quá trình thúc đẩy sự hợp tác, tin tưởng và đồng lòng giữa các thành viên
        trong tổ chức, hướng đến mục tiêu chung. Đây là nền tảng giúp văn hoá doanh nghiệp bền vững
        và lan toả một cách tự nhiên.
      </p>

      <h3>Ý nghĩa chính</h3>
      <ul class="gkt-list">
        <li>Tạo môi trường làm việc tích cực, giảm mâu thuẫn nội bộ.</li>
        <li>Tăng tinh thần hợp tác, chia sẻ kinh nghiệm và kiến thức.</li>
        <li>Giúp giữ chân nhân tài, giảm tỉ lệ nghỉ việc.</li>
        <li>Lan toả giá trị cốt lõi của doanh nghiệp hiệu quả hơn.</li>
        <li>Tăng năng suất nhờ làm việc theo đội nhóm.</li>
      </ul>
    </div>

    <div class="gkt-col" style="flex:0 0 360px; text-align:center;">
      <img class="gkt-img" src="images/teamwork1.jpg" alt="Ý nghĩa gắn kết tập thể">
    </div>
  </div>
</section>

<!-- Slide 2: Hoạt động thúc đẩy -->
<section data-branch="GanKetTapThe.2">
  <h2>Hoạt động thúc đẩy gắn kết tập thể</h2>

  <div class="gkt-row">
    <div class="gkt-col" style="flex:0 0 360px; text-align:center;">
      <img class="gkt-img" src="images/teamwork2.jpg" alt="Hoạt động gắn kết tập thể">
    </div>

    <div class="gkt-col gkt-card">
      <h3>Hoạt động tiêu biểu</h3>
      <ul class="gkt-list">
        <li>Tổ chức teambuilding, du lịch thường niên để tạo không gian giao lưu.</li>
        <li>Xây dựng chương trình đào tạo, workshop nội bộ để tăng tương tác.</li>
        <li>Tạo cơ hội nhân viên tham gia vào quyết định và đóng góp ý kiến.</li>
        <li>Khen thưởng tập thể & cá nhân, ghi nhận nỗ lực.</li>
        <li>Duy trì kênh giao tiếp cởi mở, minh bạch.</li>
      </ul>

      <h3>Lưu ý khi tổ chức</h3>
      <p>
        Thiết kế hoạt động phù hợp văn hoá công ty, đảm bảo tính liên tục, gắn kết giữa online & offline,
        và đo lường tác động (phản hồi nhân viên, tỉ lệ tham gia, mức hài lòng).
      </p>
    </div>
  </div>
</section>

<!-- Slide 3: Ví dụ minh họa & Kết luận -->
<section data-branch="GanKetTapThe.3">
  <h2>Ví dụ minh họa & Kết luận</h2>

  <div class="gkt-row">
    <div class="gkt-col gkt-card">
      <h3>Ví dụ thực tế</h3>
      <p>
        Tại một công ty truyền thông, ban lãnh đạo tổ chức các buổi <em>Town Hall Meeting</em> để mọi nhân viên
        trực tiếp trao đổi với lãnh đạo về định hướng phát triển. Các chương trình từ thiện và hoạt động cộng đồng
        cũng được tổ chức đều đặn với sự tham gia rộng rãi của nhân viên — góp phần củng cố tinh thần tập thể và
        xây dựng văn hoá doanh nghiệp có trách nhiệm xã hội.
      </p>

      <h3>Kết luận</h3>
      <p>
        Gắn kết tập thể là trụ cột quan trọng cho văn hoá doanh nghiệp vững mạnh. Khi tổ chức chú trọng và duy trì
        các hoạt động gắn kết, họ đạt được lợi ích bền vững: hiệu suất tốt hơn, nhân viên trung thành hơn và hình ảnh
        doanh nghiệp tích cực hơn trong cộng đồng.
      </p>
    </div>

    <div class="gkt-col" style="flex:0 0 320px; text-align:center;">
      <img class="gkt-img" src="images/teamwork3.jpg" alt="Ví dụ gắn kết tập thể">
    </div>
  </div>
</section>

<!-- === (TÙY CHỌN) Nếu bạn muốn node cha "GanKetTapThe" khi click cũng mở 1 slide tổng quan,
     thêm đoạn sau (không bắt buộc):
<section data-branch="GanKetTapThe">
  <h2>Gắn kết tập thể — Tổng quan</h2>
  <p>Tóm tắt ngắn — click vào các mục con để xem chi tiết.</p>
</section>
-->

<!-- Khen thưởng branch slides: ensure branch IDs consistent -->
<section class="slide anim split-vertical" data-branch="KhenThuong.3.1" data-notes="Khái niệm Ghi nhận & Khen thưởng">
  <div class="half left">
    <h2 class="fx" data-fx="pop">Khái niệm: Ghi nhận & Khen thưởng</h2>
    <p class="fx" data-fx="fadeUp">
      <strong>Ghi nhận & khen thưởng</strong> là hệ thống thiết kế để củng cố văn hóa công ty:
      biến giá trị thành hành động, khuyến khích đóng góp và tạo môi trường làm việc tích cực.
    </p>
  </div>

  <div class="half right hidden" data-staged="true">
    <img src="https://images.unsplash.com/photo-1551836022-d5d88e9218df" alt="Recognition" style="width:100%;height:auto;border-radius:12px;object-fit:cover" />
  </div>

  <div class="footer"><span></span><span class="meta">Khái niệm</span></div>
</section>

<section class="slide anim" data-branch="KhenThuong.3.2" data-notes="Các nội dung khen thưởng — tổng quan">
  <h2 class="fx" data-fx="pop">Các nội dung khen thưởng</h2>
  <ul class="fx" data-fx="fadeUp">
    <li>Ghi nhận kịp thời & công khai</li>
    <li>Khen thưởng đa dạng: tiền, trải nghiệm, biểu tượng</li>
    <li>Gắn kết khen thưởng với giá trị cốt lõi</li>
  </ul>
  <div class="footer"><span></span><span class="meta">Các nội dung</span></div>
</section>

<section class="slide anim" data-branch="KhenThuong.3.2.2" data-notes="Khen thưởng đa dạng & ý nghĩa">
  <h2 class="fx" data-fx="pop">Khen thưởng đa dạng và ý nghĩa</h2>
  <ul class="fx" data-fx="fadeUp">
    <li>Tiền thưởng / thưởng nóng</li>
    <li>Khen thưởng phi tiền tệ: kỳ nghỉ, voucher, trải nghiệm</li>
    <li>Khen thưởng biểu tượng: danh hiệu, kỷ niệm chương</li>
  </ul>

  <div class="hidden">
    <p><strong>Minh chứng:</strong> Khen thưởng gắn với văn hóa giúp củng cố hành vi mong muốn (đổi mới, hợp tác...)</p>
  </div>

  <div class="footer"><span></span><span class="meta">Khen thưởng</span></div>
</section>

<section class="slide anim" data-branch="KhenThuong.3.3" data-notes="Gắn kết khen thưởng với giá trị cốt lõi — tổng quan">
  <h2 class="fx" data-fx="pop">Gắn kết khen thưởng với giá trị cốt lõi</h2>
  <p class="fx" data-fx="fadeUp">
    Khen thưởng phải nhắc nhở nhân viên về giá trị công ty — khi gắn khen thưởng với giá trị, hành vi mong muốn được khuyến khích.
  </p>
  <div class="footer"><span></span><span class="meta">Gắn kết</span></div>
</section>

<section class="slide anim" data-branch="KhenThuong.3.3.1" data-notes="Nguyên tắc liên kết">
  <h2 class="fx" data-fx="pop">Nguyên tắc liên kết</h2>
  <ul class="fx" data-fx="fadeUp">
    <li>Định nghĩa rõ hành vi cần khuyến khích theo từng giá trị.</li>
    <li>Đảm bảo minh bạch tiêu chí khen thưởng.</li>
    <li>Kết hợp bình chọn peer-to-peer để khuyến khích tương tác.</li>
  </ul>

  <div class="footer"><span></span><span class="meta">Nguyên tắc</span></div>
</section>

<section class="slide anim" data-branch="KhenThuong.3.3.2" data-notes="Ví dụ & Thực thi">
  <h2 class="fx" data-fx="pop">Ví dụ & Thực thi</h2>
  <p class="fx" data-fx="fadeUp">
    Ví dụ: giải thưởng 'Đồng đội của bạn' (peer-to-peer), giải thưởng hàng quý cho ý tưởng sáng tạo, hay khen thưởng đội thể hiện tinh thần hợp tác.
  </p>
  <div class="footer"><span></span><span class="meta">Ví dụ</span></div>
</section>

<section class="slide anim" data-branch="KhenThuong.3.3.3" data-notes="3.3.3 Gắn kết khen thưởng với giá trị cốt lõi">
  <div class="morph-grid">
    <div class="top">
      <div class="col left fx" data-fx="morph" data-fx-dur="520">
        <h3>Ý tưởng</h3>
        <p>Đặt tiêu chí khen thưởng phản ánh trực tiếp giá trị công ty (ví dụ: đổi mới, hợp tác, tôn trọng).</p>
      </div>

      <div class="col center fx" data-fx="morph" data-fx-dur="680" data-fx-delay="60">
        <h2>Kết nối Khen thưởng → Giá trị</h2>
        <p class="lead">Khen thưởng khi được thiết kế đúng sẽ biến giá trị thành hành vi cụ thể.</p>
      </div>

      <div class="col right fx" data-fx="morph" data-fx-dur="520" data-fx-delay="120">
        <h3>Thực thi</h3>
        <p>Peer-voting, tiêu chí minh bạch, thông báo công khai và phần thưởng mang tính biểu tượng & ý nghĩa.</p>
      </div>
    </div>

    <div class="bottom">
      <div class="hidden" style="width:100%">
        <table style="width:100%;border-collapse:collapse">
          <thead><tr style="background:rgba(255,255,255,0.06)"><th style="padding:8px">Yếu tố</th><th style="padding:8px">Lợi ích</th></tr></thead>
          <tbody>
            <tr><td style="padding:8px">Tiêu chí gắn giá trị</td><td style="padding:8px">Hành vi mong muốn xuất hiện thường xuyên</td></tr>
            <tr><td style="padding:8px">Peer voting</td><td style="padding:8px">Tăng tính cộng đồng & minh bạch</td></tr>
            <tr><td style="padding:8px">Phần thưởng ý nghĩa</td><td style="padding:8px">Gia tăng động lực & cảm giác được trân trọng</td></tr>
          </tbody>
        </table>

        <div style="margin-top:14px;display:flex;flex-direction:column;align-items:center;gap:8px">
          <div>Định nghĩa → Tiêu chí → Thực thi</div>
          <div style="font-size:22px">⬇️</div>
          <div style="padding:10px;border-radius:8px;background:rgba(0,255,120,0.04)">Minh chứng: Tăng gắn kết, cải thiện hành vi, củng cố văn hoá</div>
        </div>
      </div>
    </div>
  </div>

  <div class="footer"><span></span><span class="meta">Gắn kết giá trị</span></div>
</section>
<!-- Controls -->
  <div class="controls">
    <button class="btn" id="prev">← Trước</button>
    <button class="btn" id="next">Sau →</button>
    <button class="btn" id="fs">Toàn màn hình (F)</button>
    <button class="btn" id="notesBtn">Ghi chú (P)</button>
  </div>
  <div class="progress"><i id="prog"></i></div>

  <!-- Notes modal -->
  <div id="notes" style="display:none;position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:rgba(8,8,10,.96);padding:18px;border-radius:8px;z-index:60;color:var(--muted)">
    <strong style="color:var(--text)">Notes</strong>
    <pre id="notesContent" style="white-space:pre-wrap;margin:8px 0 0 0"></pre>
  </div>
  <!-- ============ Truyền Thông.1 — Định nghĩa & Mục tiêu (split; staged reveal) ============ -->
  <section class="slide anim split-vertical comms-accent" data-branch="TruyenThong.1" data-notes="Truyền thông nội bộ — Định nghĩa & Mục tiêu">
    <div class="half left">
      <div class="comms-banner fx" data-fx="pop">
        <div class="comms-badge">Chương quan trọng</div>
        <div>
          <h2 style="margin:0;color:var(--text)">Truyền thông nội bộ</h2>
          <p style="margin:0;color:var(--muted)">Trao đổi thông tin, kết nối cảm xúc và định hình giá trị tổ chức</p>
        </div>
      </div>

      <div style="height:12px"></div>

      <p class="fx" data-fx="fadeUp">
        <strong>Khái niệm:</strong> Truyền thông nội bộ là quá trình trao đổi và chia sẻ thông tin, ý tưởng;
        là kênh kết nối cảm xúc, gắn kết các thành viên và tạo sự đồng thuận, định hình giá trị cốt lõi.
      </p>

      <div style="height:12px"></div>

      <div class="comms-steps">
        <div class="comms-step fx" data-fx="fadeUp" data-fx-delay="60">
          <div style="display:flex;align-items:flex-start">
            <div class="marker">1</div>
            <div>
              <strong>2.1 Tăng cường gắn kết & tinh thần làm việc</strong>
              <p style="margin:6px 0;color:var(--muted)">Gắn kết đến từ cảm giác thuộc về & được trân trọng.</p>
              <div class="comms-callout">
                <em>Ví dụ:</em> Lễ kỷ niệm thành lập, video hành trình và vinh danh nhân viên gắn bó lâu năm.
              </div>
            </div>
          </div>
        </div>

        <div class="comms-step fx" data-fx="fadeUp" data-fx-delay="120">
          <div style="display:flex;align-items:flex-start">
            <div class="marker">2</div>
            <div>
              <strong>2.2 Lan tỏa & củng cố văn hóa</strong>
              <p style="margin:6px 0;color:var(--muted)">Chia sẻ câu chuyện và hành vi mẫu mực để mọi nhân viên hiểu và sống theo giá trị.</p>
              <div class="comms-callout"><em>Ví dụ:</em> Chuyên mục tuần “Câu chuyện văn hóa” trong email nội bộ.</div>
            </div>
          </div>
        </div>

        <div class="comms-step fx" data-fx="fadeUp" data-fx-delay="180">
          <div style="display:flex;align-items:flex-start">
            <div class="marker">3</div>
            <div>
              <strong>2.3 Đảm bảo nhất quán & chính xác</strong>
              <p style="margin:6px 0;color:var(--muted)">Thông điệp đồng nhất, kênh chính thức để tránh tin đồn.</p>
              <div class="comms-callout"><em>Ví dụ:</em> Kênh thông tin chính thức/landing page nội bộ khi có sự cố.</div>
            </div>
          </div>
        </div>

        <div class="comms-step fx" data-fx="fadeUp" data-fx-delay="240">
          <div style="display:flex;align-items:flex-start">
            <div class="marker">4</div>
            <div>
              <strong>2.4 Hỗ trợ mục tiêu kinh doanh</strong>
              <p style="margin:6px 0;color:var(--muted)">Giúp nhân viên hiểu chiến lược & vai trò → thúc đẩy kết quả.</p>
              <div class="comms-callout"><em>Ví dụ:</em> Truyền tải quy trình kiểm soát chất lượng giúp giảm lỗi.</div>
            </div>
          </div>
        </div>

        <div class="comms-step fx" data-fx="fadeUp" data-fx-delay="300">
          <div style="display:flex;align-items:flex-start">
            <div class="marker">5</div>
            <div>
              <strong>2.5 Xây dựng mối quan hệ bền vững</strong>
              <p style="margin:6px 0;color:var(--muted)">Kênh & không gian để nhân viên tương tác, tin tưởng và tôn trọng lẫn nhau.</p>
              <div class="comms-callout"><em>Ví dụ:</em> Team building liên phòng ban theo tháng/quý.</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT: hình minh họa + staged-hidden để reveal details khi muốn -->
    <div class="half right staged-hidden" data-staged="true">
      <img src="https://images.unsplash.com/photo-1507679799987-c73779587ccf?q=80&w=1200&auto=format&fit=crop" alt="Internal communication" style="width:100%;border-radius:12px;object-fit:cover">
      <div style="height:12px"></div>
      <div class="comms-callout fx" data-fx="fadeUp" data-fx-delay="120">
        <strong>Tip triển khai:</strong> Thiết lập 1 kênh chính thức + lịch nội dung (content calendar) cho communications.
      </div>
    </div>

    <div class="footer"><span></span><span class="meta">Truyền thông nội bộ — Định nghĩa & Mục tiêu</span></div>
  </section>


  <!-- ============ Truyền Thông.2 — Hình thức, Vai trò, Ví dụ minh họa (single / two-column) ============ -->
  <section class="slide anim" data-branch="TruyenThong.2" data-notes="Truyền thông — Hình thức & Vai trò">
    <div style="padding:26px;display:flex;gap:20px;align-items:flex-start;justify-content:space-between;box-sizing:border-box">
      <div style="flex:1;min-width:320px">
        <div class="comms-banner fx" data-fx="pop">
          <div class="comms-badge">Hình thức</div>
          <div>
            <h3 style="margin:0;color:var(--text)">Các hoạt động tiêu biểu</h3>
            <p style="margin:0;color:var(--muted)">Trực tiếp • Văn bản • Công nghệ • Sự kiện</p>
          </div>
        </div>

        <div style="height:12px"></div>

        <div class="fx" data-fx="fadeUp" data-fx-delay="80">
          <ul class="comms-list" style="color:var(--muted);line-height:1.6">
            <li><strong>Truyền thông trực tiếp:</strong> cuộc họp định kỳ, 1:1, workshop, đào tạo.</li>
            <li><strong>Truyền thông qua văn bản:</strong> bản tin nội bộ, email, bảng thông báo.</li>
            <li><strong>Truyền thông qua công nghệ:</strong> intranet, Slack, Teams, app nội bộ.</li>
            <li><strong>Sự kiện nội bộ:</strong> team building, tiệc cuối năm, cuộc thi nội bộ.</li>
          </ul>
        </div>

        <div style="height:12px"></div>

        <div class="fx comms-callout" data-fx="fadeUp" data-fx-delay="140">
          <h4 style="margin:0 0 8px 0">Vai trò chính</h4>
          <ul style="color:var(--muted);line-height:1.6">
            <li>Định hình & duy trì bản sắc văn hoá.</li>
            <li>Lan tỏa giá trị cốt lõi.</li>
            <li>Tạo niềm tin, minh bạch & nâng cao trung thành.</li>
            <li>Thúc đẩy động lực & hiệu suất làm việc.</li>
          </ul>
        </div>
      </div>

      <div style="width:44%;min-width:280px">
        <img src="https://images.unsplash.com/photo-1521791136064-7986c2920216?q=80&w=1200&auto=format&fit=crop" alt="Town Hall" style="width:100%;border-radius:12px;object-fit:cover" class="fx" data-fx="pop">
        <div style="height:12px"></div>
        <div class="fx" data-fx="fadeUp" data-fx-delay="120">
          <h4 style="margin:0 0 8px 0">Ví dụ minh họa: Town Hall Meeting</h4>
          <p style="margin:0;color:var(--muted);line-height:1.5">
            Ban lãnh đạo tổ chức Town Hall để nhân viên chia sẻ ý kiến, kèm hoạt động từ thiện & cộng đồng → gia tăng văn hoá nhân văn và trách nhiệm xã hội.
          </p>
        </div>

        <div class="comms-flow fx" data-fx="fadeUp" data-fx-delay="200">
          <div class="box">Thông điệp rõ ràng</div>
          <div style="font-size:22px">→</div>
          <div class="box">Hành động nhất quán</div>
          <div style="font-size:22px">→</div>
          <div class="box">Văn hoá được củng cố</div>
        </div>
      </div>
    </div>

    <div class="footer"><span></span><span class="meta">Truyền thông — Hình thức & Vai trò</span></div>
  </section>

  <script>
  /* =========================
     WAAPI-free slide controller (extended for nested branches)
     ========================= */

  const slides = Array.from(document.querySelectorAll('.slide'));
  const prog = document.getElementById('prog');
  const notesModal = document.getElementById('notes');
  const notesContent = document.getElementById('notesContent');

  let idx = -1;
  const exactMap = {}; // map full branch key -> [slideIndices]
  const baseMap = {};  // map base (first segment) -> [slideIndices] (includes nested)
  const rootIndex = slides.indexOf(document.getElementById('slide-tree'));
  let currentBranch = null; // { id, type: 'exact'|'base', localIndex }

  // normalize branch key: trim parts and collapse multiple dots
  function normalizeBranchKey(raw){
    if(!raw) return '';
    return raw.split('.').map(p=>p.trim()).filter(Boolean).join('.');
  }

  // build branch maps (supports nested keys)
  slides.forEach((s,i)=>{
    const raw = s.dataset.branch;
    if(!raw) return;
    const key = normalizeBranchKey(raw);
    if(!key) return;
    // exact map
    if(!exactMap[key]) exactMap[key]=[];
    exactMap[key].push(i);

    // base map: first segment
    const base = key.split('.')[0];
    if(!baseMap[base]) baseMap[base]=[];
    baseMap[base].push(i);
  });

  // helper parse ms (supports "0.45s" and "450ms" and numbers)
  function parseMS(v){
    if(v==null) return null;
    if(typeof v === 'number') return v;
    const s = String(v).trim();
    if(s.endsWith('ms')) return parseFloat(s);
    if(s.endsWith('s')) return parseFloat(s)*1000;
    const n = Number(s);
    return isNaN(n)? null : n;
  }

  function getSlideTransitionMs(slideEl){
    if(!slideEl) return parseMS(getComputedStyle(document.documentElement).getPropertyValue('--slide-transition')) || 450;
    const cs = getComputedStyle(slideEl);
    const durations = cs.transitionDuration.split(',').map(s=>parseMS(s.trim())).filter(Boolean);
    const delays = cs.transitionDelay.split(',').map(s=>parseMS(s.trim())).filter(Boolean);
    const maxDur = durations.length ? Math.max(...durations) : (parseMS(getComputedStyle(document.documentElement).getPropertyValue('--slide-transition')) || 450);
    const maxDelay = delays.length ? Math.max(...delays) : 0;
    return Math.round(maxDur + maxDelay);
  }

  const FX_MAP = {
    fadeUp:  { transform: 'translate3d(0,0,0) scale(1)', opacity: '1', initial: 'translate3d(0,18px,0) scale(1)' },
    pop:     { transform: 'translate3d(0,0,0) scale(1)', opacity: '1', initial: 'translate3d(0,6px,0) scale(.94)' },
    slideLeft:{ transform: 'translate3d(0,0,0) scale(1)', opacity: '1', initial: 'translate3d(-28px,0,0) scale(1)' },
    slideRight:{ transform: 'translate3d(0,0,0) scale(1)', opacity: '1', initial: 'translate3d(28px,0,0) scale(1)' },
    morph:   { transform: 'translate3d(0,0,0) scale(1) rotate(0deg)', opacity: '1', initial: 'translate3d(0,0,0) scale(.86) rotate(-2deg)' }
  };

  let pendingFxTimer = null;
  function cancelAllFx(){
    document.querySelectorAll('.fx').forEach(el=>{
      el.classList.remove('is-active');
      el.style.transition = '';
      el.style.transitionDelay = '';
      el.style.transitionDuration = '';
    });
    if(pendingFxTimer){ clearTimeout(pendingFxTimer); pendingFxTimer = null; }
  }

  function playCssFx(el, final, dur, delay){
    dur = parseInt(dur) || 360;
    delay = parseInt(delay) || 0;
    el.style.transition = `transform ${dur}ms var(--fx-ease) ${delay}ms, opacity ${dur}ms ease ${delay}ms`;
    el.style.willChange = 'transform, opacity';
    el.style.transform = final.initial || 'translate3d(0,8px,0) scale(.995)';
    el.style.opacity = '0';
    void el.offsetWidth;
    requestAnimationFrame(()=>{
      requestAnimationFrame(()=>{
        el.style.transform = final.transform || 'translate3d(0,0,0) scale(1)';
        el.style.opacity = final.opacity != null ? final.opacity : '1';
        setTimeout(()=>{ el.classList.add('is-active'); }, dur + delay);
      });
    });
  }

  function activateFxInContainer(container, opts = {}){
    if(!container) return;
    const defaultStagger = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--fx-default-stagger')) || 60;
    const startDelay = opts.startDelay || 0;
    const maxDurClamp = opts.maxDur || 1200;
    const minDurClamp = opts.minDur || 120;

    const all = Array.from(container.querySelectorAll('.fx'));
    const els = all.filter(el => {
      if (el.closest('.staged-hidden') || el.closest('[data-staged="true"].staged-hidden')) return false;
      return true;
    });

    els.forEach((el, i) => {
      const fxName = (el.dataset.fx || 'fadeUp').trim();
      let dur = parseMS(el.dataset.fxDur) || parseMS(getComputedStyle(document.documentElement).getPropertyValue('--fx-default-dur')) || 760;
      dur = Math.min(maxDurClamp, Math.max(minDurClamp, dur));
      const explicitDelay = parseMS(el.dataset.fxDelay);
      const staggerDelay = (explicitDelay != null) ? explicitDelay : (i * defaultStagger);
      const totalDelay = (startDelay || 0) + staggerDelay;
      const final = FX_MAP[fxName] || FX_MAP.fadeUp;
      playCssFx(el, final, dur, totalDelay);
    });
  }
  function activateFxForSlide(slide){
    if(!slide) return;
    cancelAllFx();
    const slideTransMs = getSlideTransitionMs(slide);
    const startAt = Math.max(40, Math.round(slideTransMs * 0.28));
    pendingFxTimer = setTimeout(()=>{
      activateFxInContainer(slide, { startDelay: 0 });
      pendingFxTimer = null;
    }, startAt);
  }

  function getStagedHiddenSectors(slideEl){
    if(!slideEl) return [];
    return Array.from(slideEl.querySelectorAll('.staged-hidden, [data-staged="true"].staged-hidden, .sector.staged-hidden, .half.staged-hidden'));
  }
  function getStagedVisibleSectors(slideEl){
    if(!slideEl) return [];
    return Array.from(slideEl.querySelectorAll('.staged-visible, [data-staged="true"].staged-visible, .sector.staged-visible, .half.staged-visible'));
  }
  function resetFxInContainer(container){
    if(!container) return;
    const fxEls = Array.from(container.querySelectorAll('.fx'));
    fxEls.forEach(el=>{
      el.classList.remove('is-active');
      el.style.transition = '';
      el.style.transitionDelay = '';
      el.style.transitionDuration = '';
      el.style.willChange = '';
      const fn = el.dataset.fx ? el.dataset.fx.trim() : null;
      const initial = (typeof FX_MAP !== 'undefined' && fn && FX_MAP[fn] && FX_MAP[fn].initial) ? FX_MAP[fn].initial : 'translate3d(0,8px,0) scale(.995)';
      el.style.transform = initial;
      el.style.opacity = '0';
    });
  }
  function resetStagedState(slideEl){
  if(!slideEl) return;
  const stagedCandidates = Array.from(slideEl.querySelectorAll('[data-staged="true"], .staged-visible, .staged-hidden, .sector, .half'))
    .filter(el => el.closest && slideEl.contains(el));

  stagedCandidates.forEach(el=>{
    if(el.dataset && el.dataset.staged !== undefined){
      el.classList.remove('staged-visible');
      el.classList.add('staged-hidden');
    } else {
      if(el.classList.contains('staged-visible')) {
        el.classList.remove('staged-visible');
        el.classList.add('staged-hidden');
      }
    }
  });
}
  function resetSlideForReuse(slideEl){
    if(!slideEl) return;
    resetStagedState(slideEl);
    resetFxInContainer(slideEl);
  }
  function hideLastVisibleSectorInSlide(slideEl){
    const visibles = getStagedVisibleSectors(slideEl);
    if(visibles.length === 0) return false;
    const last = visibles[visibles.length - 1];
    Array.from(last.querySelectorAll('.fx')).forEach(el=>{
      el.classList.remove('is-active');
      el.style.transition = '';
      el.style.opacity = '0';
      el.style.transform = '';
      el.style.transitionDelay = '';
    });
    last.classList.remove('staged-visible');
    last.classList.add('staged-hidden');
    return true;
  }

  function revealNextSectorInSlide(slideEl){
    const hidden = getStagedHiddenSectors(slideEl);
    if(hidden.length === 0) return false;
    const next = hidden[0];
    next.classList.remove('staged-hidden');
    next.classList.add('staged-visible');
    setTimeout(()=> {
      activateFxInContainer(next, { startDelay: 20 });
    }, 30);
    return true;
  }

  function go(n){
    const target = Math.max(0, Math.min(slides.length-1, n));
    if(target === idx) return; // no-op

    // prefer resetting the *outgoing* slide instead of the incoming one
    // to avoid heavy layout churn on the target (fixes jerky behaviour on grid / complex slides)
    const prev = idx;
    try{ resetSlideForReuse(slides[prev]); }catch(e){}

    idx = target;

    // toggle active class on next animation frame so the browser can batch layout changes
    requestAnimationFrame(()=>{
      slides.forEach((s,i)=> s.classList.toggle('active', i===idx));
      Array.from(document.querySelectorAll('.meta')).forEach((m,i)=> m.textContent = `Slide ${i+1}/${slides.length}`);
      prog.style.width = `${((idx+1)/slides.length)*100}%`;

      // Toggle body class so CSS can switch backgrounds/pseudo-elements
      if(slides[idx] && slides[idx].classList.contains('intro')){
        document.body.classList.add('intro-active');
      } else {
        document.body.classList.remove('intro-active');
      }

      // wait a short fraction of the slide transition to let the layout settle, then start FX
      const slideTransMs = getSlideTransitionMs(slides[idx]) || 450;
      const fxStart = Math.max(20, Math.round(slideTransMs * 0.18));
      setTimeout(()=> activateFxForSlide(slides[idx]), fxStart);
    });
  }

  function update(){
    slides.forEach((s,i)=> s.classList.toggle('active', i===idx));
    Array.from(document.querySelectorAll('.meta')).forEach((m,i)=> m.textContent = `Slide ${i+1}/${slides.length}`);
    prog.style.width = `${((idx+1)/slides.length)*100}%`;
    activateFxForSlide(slides[idx]);
  }

  // Branch-aware navigation that supports nested branches
  function checkIndex(branchId, subIndex){
    if(!branchId) return goRoot();
    const key = normalizeBranchKey(branchId);

    // exact match first
    if(exactMap[key] && exactMap[key].length){
      const arr = exactMap[key];
      const si = (typeof subIndex === 'number') ? subIndex : 0;
      const clamped = Math.max(0, Math.min(arr.length-1, si));
      go(arr[clamped]);
      currentBranch = { id: key, type: 'exact', localIndex: clamped };
      return;
    }

    // fallback to base map (first segment)
    const base = key.split('.')[0];
    if(baseMap[base] && baseMap[base].length){
      const arr = baseMap[base];
      const si = (typeof subIndex === 'number') ? subIndex : 0;
      const clamped = Math.max(0, Math.min(arr.length-1, si));
      go(arr[clamped]);
      currentBranch = { id: base, type: 'base', localIndex: clamped };
      return;
    }

    console.warn(`Branch "${branchId}" not found.`);
    goRoot();
  }

  function goRoot(){ currentBranch = null; go(rootIndex); }

  function revealNextElementInSlide(slideEl) {
    if(!slideEl) return false;
    const allFx = Array.from(slideEl.querySelectorAll('.fx'));
    const candidates = allFx.filter(el => {
      if(el.classList.contains('is-active')) return false;
      if(el.closest('.staged-hidden') || el.closest('[data-staged="true"].staged-hidden')) return false;
      return true;
    });

    if(candidates.length === 0) return false;
    const el = candidates[0];
    const fxName = (el.dataset.fx || 'fadeUp').trim();
    const dur = parseInt(el.dataset.fxDur) || parseInt(getComputedStyle(document.documentElement).getPropertyValue('--fx-default-dur')) || 360;
    const delay = parseInt(el.dataset.fxDelay) || 0;
    const final = (typeof FX_MAP !== 'undefined' && FX_MAP[fxName]) ? FX_MAP[fxName] : FX_MAP.fadeUp;
    playCssFx(el, final, dur, delay);

    return true;
  }

  function next(){
    const activeSlide = slides[idx];
    if (revealNextElementInSlide(activeSlide)) return;
    if (revealNextSectorInSlide(activeSlide)) return;

    // branch progression with support for 'exact' or 'base' branch current
    if(currentBranch){
      if(currentBranch.type === 'exact'){
        const arr = exactMap[currentBranch.id] || [];
        const nextLocal = currentBranch.localIndex + 1;
        if(nextLocal >= arr.length) goRoot();
        else checkIndex(currentBranch.id, nextLocal);
      } else {
        const arr = baseMap[currentBranch.id] || [];
        const nextLocal = currentBranch.localIndex + 1;
        if(nextLocal >= arr.length) goRoot();
        else {
          // when using baseMap, navigate to the next slide in that base sequence
          checkIndex(currentBranch.id, nextLocal);
        }
      }
    } else {
      if(idx >= slides.length - 1) go(0);
      else go(idx+1);
    }
  }

  function prev(){
    const activeSlide = slides[idx];
    if(hideLastVisibleSectorInSlide(activeSlide)) return;
    if(currentBranch){
      if(currentBranch.type === 'exact'){
        const arr = exactMap[currentBranch.id] || [];
        const prevLocal = currentBranch.localIndex - 1;
        if(prevLocal < 0) goRoot();
        else checkIndex(currentBranch.id, prevLocal);
      } else {
        const arr = baseMap[currentBranch.id] || [];
        const prevLocal = currentBranch.localIndex - 1;
        if(prevLocal < 0) goRoot();
        else checkIndex(currentBranch.id, prevLocal);
      }
    } else {
      if(idx <= 0) go(slides.length-1);
      else go(idx-1);
    }
  }

  /* ============= UI wiring ============= */
  document.getElementById('next').addEventListener('click', next);
  document.getElementById('prev').addEventListener('click', prev);
  document.getElementById('fs').addEventListener('click', ()=>{ if(!document.fullscreenElement) document.documentElement.requestFullscreen().catch(()=>{}); else document.exitFullscreen().catch(()=>{}); });
  document.getElementById('notesBtn').addEventListener('click', toggleNotes);
  window.addEventListener('keydown', e=>{ if(e.key==='ArrowRight') next(); if(e.key==='ArrowLeft') prev(); if(e.key.toLowerCase()==='p') toggleNotes(); });

  function toggleNotes(){
    const notes = slides[idx].dataset.notes || '';
    if(!notesModal) return;
    if(notesModal.style.display === 'block') notesModal.style.display = 'none';
    else { notesContent.textContent = notes; notesModal.style.display = 'block'; }
  }
  notesModal?.addEventListener('click', e=>{ if(e.target===notesModal) notesModal.style.display='none' });

  /* ============= Tree click binding (supports nested keys) ============= */
  document.querySelectorAll('#tree .tree-node').forEach(node=>{
    let rawBranch = node.dataset.branch || '';
    node.addEventListener('click', ev=>{
      ev.stopPropagation();
      document.querySelectorAll('#tree .tree-node').forEach(n=>n.classList.remove('selected'));
      node.classList.add('selected');

      // normalize and decide whether this is an exact nested key or a base key with numeric suffix
      const key = normalizeBranchKey(rawBranch);
      const parts = key.split('.');

      if(parts.length > 1){
        // full (nested/exact) key like "Nhân Viên.1" or "A.B.C" — try exact first
        checkIndex(key, 0);
      } else {
        // base key like "Nhân Viên" — open base's first slide
        checkIndex(key, 0);
      }
    });
    node.addEventListener('keydown', e=>{ if(e.key==='Enter' || e.key===' ') node.click(); });
  });

  /* ============= init ============= */
  go(0);

  /* ============= particles (lighter default) ============= */
  const canvas = document.getElementById('particles');
  const ctx = canvas.getContext?.('2d');
  let w,h;
  function resize(){ if(!ctx) return; w = canvas.width = innerWidth; h = canvas.height = innerHeight; }
  resize(); window.addEventListener('resize', resize);
  const particles = Array.from({length:30}, ()=>({ x:Math.random()*innerWidth, y:Math.random()*innerHeight, r:Math.random()*1.2+0.4, dx:(Math.random()-0.5)*0.25, dy:(Math.random()-0.5)*0.25 }));
  function draw(){
    if(!ctx) return;
    ctx.clearRect(0,0,w,h);
    ctx.fillStyle='rgba(255,255,255,0.06)';
    particles.forEach(p=>{ ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); p.x+=p.dx; p.y+=p.dy; if(p.x<-10) p.x=w+10; if(p.x>w+10) p.x=-10; if(p.y<-10) p.y=h+10; if(p.y>h+10) p.y=-10; });
    requestAnimationFrame(draw);
  }
  draw();

  const mq = window.matchMedia('(prefers-reduced-motion: reduce)');
  if(mq.matches){
    document.querySelectorAll('.fx').forEach(el=>{ el.style.transition='none'; el.style.opacity='1'; el.style.transform='none'; });
  }
  </script>

</body>
</html>
